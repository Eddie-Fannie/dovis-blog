(window.webpackJsonp=window.webpackJsonp||[]).push([[245],{517:function(s,t,a){"use strict";a.r(t);var n=a(10),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_4-深入浅出webpack"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-深入浅出webpack"}},[s._v("#")]),s._v(" 4. 深入浅出Webpack")]),s._v(" "),t("h2",{attrs:{id:"第一章-入门"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一章-入门"}},[s._v("#")]),s._v(" 第一章 入门")]),s._v(" "),t("h3",{attrs:{id:"_1-1-模块化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-模块化"}},[s._v("#")]),s._v(" 1.1. 模块化")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("CommonJS")]),s._v("（http：//www.commonjs.org）是一种被广泛使用的 "),t("code",[s._v("JavaScript")]),s._v(" 模块化规范，其核心思想是通过"),t("code",[s._v("require")]),s._v("方法来同步加载依赖的其他模块，通过"),t("code",[s._v("module.exports")]),s._v("导出需要暴露的接口。")])]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("CommonJS")]),s._v("优点：")]),s._v(" "),t("ul",[t("li",[s._v("代码可复用于"),t("code",[s._v("Node.js")]),s._v("环境并运行")]),s._v(" "),t("li",[s._v("通过"),t("code",[s._v("NPM")]),s._v("发布很多第三方模块都采用"),t("code",[s._v("CommonJS")]),s._v("规范\n"),t("code",[s._v("CommonJS")]),s._v(" 的缺点在于，这样的代码无法直接运行在浏览器环境下，必须通过工具转换成标准的"),t("code",[s._v("ES5")])])])]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("code",[s._v("AMD")]),s._v("也是一种JavaScript模块化规范，与"),t("code",[s._v("CommonJS")]),s._v("最大的不同在于，它采用了异步的方式去加载依赖的模块。AMD规范主要用于解决针对浏览器环境的模块化问题，最具代表性的实现是 requirejs（http：//requirejs.org）。")])]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("AMD")]),s._v("的优点在于：")]),s._v(" "),t("ul",[t("li",[s._v("可在不转换代码的情况下直接在浏览器中运行")]),s._v(" "),t("li",[s._v("可异步加载依赖;")]),s._v(" "),t("li",[s._v("可并行加载多个依赖；")]),s._v(" "),t("li",[s._v("代码可运行在浏览器环境和"),t("code",[s._v("Node.js")]),s._v("环境下。\n"),t("code",[s._v("AMD")]),s._v("的缺点在于:")]),s._v(" "),t("li",[s._v("JavaScript运行环境没有原生支持"),t("code",[s._v("AMD")]),s._v("，需要先导入实现了"),t("code",[s._v("AMD")]),s._v("的库后才能正常使用。")])])]),s._v(" "),t("h3",{attrs:{id:"_1-3-安装webpack"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-安装webpack"}},[s._v("#")]),s._v(" 1.3 安装Webpack")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("Webpack")]),s._v("是一个打包模块化"),t("code",[s._v("JavaScript")]),s._v("的工具，它会从入口文件"),t("code",[s._v("main.js")]),s._v("出发，识别出源码中的模块化导入语句，递归地找出入口文件的所有依赖，将入口和其所有依赖打包到一个单独的文件中。")])]),s._v(" "),t("h3",{attrs:{id:"_1-4-使用loader"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-使用loader"}},[s._v("#")]),s._v(" 1.4 使用Loader")]),s._v(" "),t("ol",[t("li",[s._v("每个 "),t("code",[s._v("Loader")]),s._v(" 都可以通过 "),t("code",[s._v("URL querystring")]),s._v(" 的方式传入参数，例如 "),t("code",[s._v("css-loader？minimize")]),s._v("中的"),t("code",[s._v("minimize")]),s._v("告诉"),t("code",[s._v("css-loader")]),s._v("要开启"),t("code",[s._v("CSS")]),s._v("压缩。")]),s._v(" "),t("li",[s._v("向"),t("code",[s._v("Loader")]),s._v("传入属性的方式除了可以通过"),t("code",[s._v("querystring")]),s._v("实现，还可以通过"),t("code",[s._v("Object")]),s._v("实现，配置文件中的"),t("code",[s._v("options")]),s._v("属性")])]),s._v(" "),t("h3",{attrs:{id:"_1-6-使用devserver"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-使用devserver"}},[s._v("#")]),s._v(" 1.6 使用DevServer")]),s._v(" "),t("ol",[t("li",[s._v("通过"),t("code",[s._v("DevServer")]),s._v("启动的"),t("code",[s._v("Webpack")]),s._v("会开启监听模式，当发生变化时重新执行构建，然后通知"),t("code",[s._v("DevServer")]),s._v("。"),t("code",[s._v("DevServer")]),s._v("会让"),t("code",[s._v("Webpack")]),s._v("在构建出的"),t("code",[s._v("JavaScript")]),s._v("代码里注入一个代理客户端用于控制网页，网页和"),t("code",[s._v("DevServer")]),s._v("之间通过"),t("code",[s._v("WebSocket")]),s._v("协议通信，以方便"),t("code",[s._v("DevServer")]),s._v("主动向客户端发送命令。"),t("code",[s._v("DevServer")]),s._v("在收到来自"),t("code",[s._v("Webpack")]),s._v("的文件变化通知时，通过注入的客户端控制网页刷新。")]),s._v(" "),t("li",[s._v("如果尝试修改"),t("code",[s._v("index.html")]),s._v("文件并保存，则我们会发现这并不会触发以上机制，导致这个问题的原因是"),t("code",[s._v("Webpack")]),s._v("在启动时会以配置里的"),t("code",[s._v("entry")]),s._v("为入口去递归解析出"),t("code",[s._v("entry")]),s._v("所依赖的文件，只有"),t("code",[s._v("entry")]),s._v("本身和依赖的文件才会被"),t("code",[s._v("Webpack")]),s._v("添加到监听列表里。而"),t("code",[s._v("index.html")]),s._v("文件是脱离了"),t("code",[s._v("JavaScript")]),s._v("模块化系统的，所以"),t("code",[s._v("Webpack")]),s._v("不知道它的存在。")]),s._v(" "),t("li",[t("code",[s._v("Webpack")]),s._v("支持生成"),t("code",[s._v("Source Map")]),s._v("，只需在启动时带上"),t("code",[s._v("--devtool source-map")]),s._v("参数。重启 "),t("code",[s._v("DevServer")]),s._v("后刷新页面，再打开 "),t("code",[s._v("Chrome")]),s._v("浏览器的开发者工具，就可以在 "),t("code",[s._v("Sources")]),s._v("栏中看到可调试的源代码了。")])]),s._v(" "),t("h3",{attrs:{id:"_1-7-核心概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-核心概念"}},[s._v("#")]),s._v(" 1.7 核心概念")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("Module")]),s._v("：模块，在"),t("code",[s._v("Webpack")]),s._v("里一切皆模块，一个模块对应一个文件。"),t("code",[s._v("Webpack")]),s._v("会从配置的"),t("code",[s._v("Entry")]),s._v("开始递归找出所有依赖的模块。")]),s._v(" "),t("li",[t("code",[s._v("Chunk")]),s._v("：代码块，一个"),t("code",[s._v("Chunk")]),s._v("由多个模块组合而成，用于代码合并与分割。")])]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("Webpack")]),s._v("在启动后会从"),t("code",[s._v("Entry")]),s._v("里配置的"),t("code",[s._v("Module")]),s._v("开始，递归解析"),t("code",[s._v("Entry")]),s._v("依赖的所有"),t("code",[s._v("Module")]),s._v("。每找到一个"),t("code",[s._v("Module")]),s._v("，就会根据配置的"),t("code",[s._v("Loader")]),s._v("去找出对应的转换规则，对"),t("code",[s._v("Module")]),s._v("进行转换后，再解析出当前"),t("code",[s._v("Module")]),s._v("依赖的"),t("code",[s._v("Module")]),s._v("。这些模块会以"),t("code",[s._v("Entry")]),s._v("为单位进行分组，一个"),t("code",[s._v("Entry")]),s._v("及其所有依赖的"),t("code",[s._v("Module")]),s._v("被分到一个组也就是一个"),t("code",[s._v("Chunk")]),s._v("。最后，"),t("code",[s._v("Webpack")]),s._v("会将所有"),t("code",[s._v("Chunk")]),s._v("转换成文件输出。在整个流程中，"),t("code",[s._v("Webpack")]),s._v("会在恰当的时机执行"),t("code",[s._v("Plugin")]),s._v("里定义的逻辑。")])]),s._v(" "),t("h2",{attrs:{id:"第五章-原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第五章-原理"}},[s._v("#")]),s._v(" 第五章 原理")]),s._v(" "),t("h3",{attrs:{id:"_5-4-plugin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-plugin"}},[s._v("#")]),s._v(" 5.4 plugin")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("Webpack")]),s._v("通过"),t("code",[s._v("Plugin")]),s._v("机制让其更灵活，以适应各种应用场景。在"),t("code",[s._v("Webpack")]),s._v("运行的生命周期中会广播许多事件，"),t("code",[s._v("Plugin")]),s._v("可以监听这些事件，在合适的时机通过"),t("code",[s._v("Webpack")]),s._v("提供的"),t("code",[s._v("API")]),s._v("改变输出结果。")])]),s._v(" "),t("p",[s._v("一个最基础的"),t("code",[s._v("plugin")]),s._v("代码：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BasicPlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在构造函数中获取用户为该插件传入的配置")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("constructor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("options")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// webpack会调用BasicPlugin实例的apply方法为插件实例传入compiler对象")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("compiler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    compiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("plugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'compilation'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("compilation")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 导出plugin")]),s._v("\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" BasicPlugin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用时相关配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" BasicPlugin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./BasicPlugin.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("plugins")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BasicPlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("blockquote",[t("p",[t("code",[s._v("Webpack")]),s._v("启动后，在读取配置的过程中会先执行"),t("code",[s._v("new BasicPlugin（options）")]),s._v("，初始化一个 "),t("code",[s._v("BasicPlugin")]),s._v(" 并获得其实例。在初始化 "),t("code",[s._v("compiler")]),s._v(" 对象后，再调用"),t("code",[s._v("basicPlugin.apply（compiler）")]),s._v("为插件实例传入 "),t("code",[s._v("compiler")]),s._v(" 对象。插件实例在获取到"),t("code",[s._v("compiler")]),s._v(" 对象后，就可以通过 "),t("code",[s._v("compiler.plugin")]),s._v("（事件名称，回调函数）监听到"),t("code",[s._v("Webpack")]),s._v(" 广播的事件，并且可以通过"),t("code",[s._v("compiler")]),s._v(" 对象去操作"),t("code",[s._v("Webpack")]),s._v("。")])]),s._v(" "),t("h4",{attrs:{id:"_5-4-1-compiler和compilation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-1-compiler和compilation"}},[s._v("#")]),s._v(" 5.4.1 Compiler和Compilation")]),s._v(" "),t("blockquote",[t("p",[s._v("在开发"),t("code",[s._v("Plugin")]),s._v("时最常用的两个对象就是"),t("code",[s._v("Compiler")]),s._v("和"),t("code",[s._v("Compilation")]),s._v("，它们是"),t("code",[s._v("Plugin")]),s._v("和"),t("code",[s._v("Webpack")]),s._v("之间的桥梁。")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[t("code",[s._v("Compiler")]),s._v("对象包含了"),t("code",[s._v("Webpack")]),s._v("环境的所有配置信息，包含"),t("code",[s._v("options")]),s._v("、"),t("code",[s._v("loaders")]),s._v("、"),t("code",[s._v("plugins")]),s._v("等信息。这个对象在 "),t("code",[s._v("Webpack")]),s._v(" 启动时被实例化，它是全局唯一的，可以简单地将它理解为"),t("code",[s._v("Webpack")]),s._v("实例。")]),s._v(" "),t("p",[t("code",[s._v("Compilation")]),s._v("对象包含了当前的模块资源、编译生成资源、变化的文件等。当"),t("code",[s._v("Webpack")]),s._v("以开发模式运行时，每当检测到一个文件发生变化，便有一次新的"),t("code",[s._v("Compilation")]),s._v("被创建。"),t("code",[s._v("Compilation")]),s._v("对象也提供了很多事件回调供插件进行扩展。通过"),t("code",[s._v("Compilation")]),s._v("也能读取到"),t("code",[s._v("Compiler")]),s._v("对象。")]),s._v(" "),t("p",[t("code",[s._v("Compiler")]),s._v("和"),t("code",[s._v("Compilation")]),s._v("的区别在于："),t("code",[s._v("Compiler")]),s._v("代表了整个"),t("code",[s._v("Webpack")]),s._v("从启动到关闭的生命周期，而"),t("code",[s._v("Compilation")]),s._v("只代表一次新的编译。")])]),s._v(" "),t("h4",{attrs:{id:"_5-4-2事件流"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-2事件流"}},[s._v("#")]),s._v(" 5.4.2事件流")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("Webpack")]),s._v("就像一条生产线，要经过一系列处理流程后才能将源文件转换成输出结果。这条生产线上的每个处理流程的职责都是单一的，多个流程之间存在依赖关系，只有在完成当前处理后才能提交给下一个流程去处理。插件就像插入生产线中的某个功能，在特定的时机对生产线上的资源进行处理。")])]),s._v(" "),t("p",[t("code",[s._v("Webpack")]),s._v("通过"),t("code",[s._v("Tapable")]),s._v("来组织这条生产线。"),t("strong",[t("code",[s._v("Webpack")]),s._v("在运行的过程中会广播事件，插件只需要监听它所关心的事件，就能加入这条生产线中，去改变生产线的运作。"),t("code",[s._v("Webpack")]),s._v("的事件流机制保证了插件的有序性，使得整个系统的扩展性良好。")])]),s._v(" "),t("p",[t("code",[s._v("Webpack")]),s._v("的事件流机制应用了观察者模式，和Node.js中的"),t("code",[s._v("EventEmitter")]),s._v("非常相似。"),t("code",[s._v("Compiler")]),s._v("和"),t("code",[s._v("Compilation")]),s._v("都继承自"),t("code",[s._v("Tapable")]),s._v("，可以直接在"),t("code",[s._v("Compiler")]),s._v("和"),t("code",[s._v("Compilation")]),s._v("对象上广播和监听事件。")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" 广播事件\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name为事件名称，注意不要和现有事件重名\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" params为附带的参数\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compiler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'event-name'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" 监听名称为event"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name的事件，当event"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name事件发生时，函数就会被执行。\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" 同时函数中的params 参数为广播事件时附带的参数。\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\ncompiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("plugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'event-name'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("params")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("在开发插件时，还需要注意以下两点：只要能拿到"),t("code",[s._v("Compiler")]),s._v("或"),t("code",[s._v("Compilation")]),s._v("对象，就能广播新的事件，所以在新开发的插件中也能广播事件，为其他插件监听使用。传给每个插件的"),t("code",[s._v("Compiler")]),s._v("和"),t("code",[s._v("Compilation")]),s._v("对象都是同一个引用。也就是说，若在一个插件中修改了"),t("code",[s._v("Compiler")]),s._v("或"),t("code",[s._v("Compilation")]),s._v("对象上的属性，就会影响到后面的插件。有些事件是异步的，这些异步的事件就会附带两个参数，第2个参数为回调函数，在插件处理完任务时需要调用回调函数通知"),t("code",[s._v("Webpack")]),s._v("，才会进入下一个处理流程。")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("compiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("plugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'emit'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("compilation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 支持处理逻辑")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 处理完毕后执行callback已通知Webpack")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果不执行callback，运行流程会一直卡在这里不往后执行")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("h4",{attrs:{id:"_5-4-3-最常用的api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-3-最常用的api"}},[s._v("#")]),s._v(" 5.4.3 最常用的API")]),s._v(" "),t("ol",[t("li",[s._v("读取输出资源，代码块，模块及其依赖\n"),t("code",[s._v("emit")]),s._v("事件发生时，代表源文件的转换和组装已经完成，在这里可以读取到最终将输出的资源、代码块、模块及其依赖，并且可以修改输出资源的内容。")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("compiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("plugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'emit'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("compilation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// compilation.chunks存放所有代码块，是一个数组")]),s._v("\n  compilation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("chunks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("chunk")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// chunk代表一个代码块")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 代码块由多个模块组成，通过chunk.forEachModule能读取代码块的每个模块")]),s._v("\n    chunk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEachModule")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("module")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// module代表一个模块")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// module.fileDependencies存放当前模块的所有依赖的文件路径，是一个数组")]),s._v("\n      module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fileDependencies"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("filepath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// webpack会根据chunk生成输出的文件资源，每个chunk都对应一个及以上的输出文件")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 例如在chunk中包含css模块并且使用了ExtractTextPlugin时，")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 该chunk就会生成.js和.css两个文件")]),s._v("\n    chunk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("files"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("filename")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// compilation.assets存放当前即将输出的所有资源")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 调用一个输出资源的source()方法能获取输出资源的内容")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" source "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" compilation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("assets"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("filename"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("source")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这是一个异步事件，要记得调用callback来通知Webpack本次事件监听处理结束")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果忘记了调用callback，则webpack将一直卡在这里而不会往后执行")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("监听文件的变化\n在开发插件时经常需要知道是哪个文件发生的变化导致了新的"),t("code",[s._v("Compilation")]),s._v("，为此可以使用如下代码：")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当依赖的文件发生变化时会触发watch-run事件")]),s._v("\ncompiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("plugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'watch-run'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("watching"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取发生变化时的文件列表")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" changedFiles "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" watching"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("compiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("watchFileSystem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("watcher"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mtimes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// changedFiles格式为键值对，键为发生变化的文件路径。")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("changedFiles"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("filePath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// filePath对应的文件发生了变化")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("在默认情况下，webpack只会监视入口和其依赖的模块是否发生了变化，在某些情况下项目可能需要引入新的文件，例如引入一个"),t("code",[s._v("HTML")]),s._v("文件。由于JS文件不会导入HTML文件，所以webpack不会监听HTML文件的变化，编辑HTML文件时就不会重新触发新的"),t("code",[s._v("Compilation")]),s._v("。为了监听HTML文件变化，我们需要将HTML文件加入依赖列表中：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("compiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("plugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'after-compile'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("compilation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 将HTML文件添加到文件依赖列表中，好让Webpack监听HTML模版文件，在HTML模版文件变化时重新启动一次编译。")]),s._v("\n  compilation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fileDependencies"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("push")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("filePath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("修改输出资源\n在某些场景下插件需要修改，增加，删除输出的资源，要做到这点则需要监听"),t("code",[s._v("emit")]),s._v("事件，因为发生"),t("code",[s._v("emit")]),s._v("事件时所有模块的转换和代码块对应的文件已经生成好，需要输出的资源即将输出，因此"),t("code",[s._v("emit")]),s._v("事件时修改"),t("code",[s._v("webpack")]),s._v("输出资源的最后的时机。"),t("strong",[s._v("所有需要输出的资源都会被存放在"),t("code",[s._v("compilation.assets")]),s._v("中，"),t("code",[s._v("compilation.assets")]),s._v("是一个键值对，键为需要输出的文件名称，值为文件对应的内容。")])])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置compilation.assets的代码如下：")]),s._v("\ncompiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("plugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'emit'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("compilation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置名称为fileName的输出资源")]),s._v("\n  compilation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("assets"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fileName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 返回文件内容")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("source")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// fileContent既可以是代表文本文件的字符串，也可以是代表二进制文件的Buffer")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" fileContent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("size")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("byteLength")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fileContent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf8'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("读取"),t("code",[s._v("compilation.assets")]),s._v("的代码如下：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("compiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("plugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'emit'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("compilation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 读取名称为fileName的输出资源")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" assets "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" compilation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("assets"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fileName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取输出资源的内容")]),s._v("\n  assets"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("source")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取输出资源的文件大小")]),s._v("\n  asset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("判断Webpack使用了哪些插件\n在开发一个插件时，我们可能需要根据当前配置是否使用了其他插件来做下一步决定，因此需要读取"),t("code",[s._v("Webpack")]),s._v("当前的插件配置情况。比如，若想判断当前是否使用了"),t("code",[s._v("ExtractTextPlugin")]),s._v("，则可以使用如下代码：")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 判断当前配置是否使用了ExtractTextPlugin")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// compiler参数为webpack在apply(compiler)中传入的参数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hasExtractTextPlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("compiler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前配置使用的所有插件列表")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" plugins "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" compiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("plugins"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 去plugins中寻找有没有ExtractTextplugin的实例")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" plugins"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("plugin")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" plugin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("__proto__")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("constructor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" ExtractTextPlugin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[t("code",[s._v("ExtractTextPlugin")]),s._v("插件它会将所有的入口 "),t("code",[s._v("chunk(entry chunks)")]),s._v("中引用的 "),t("code",[s._v("*.css")]),s._v("，移动到独立分离的 "),t("code",[s._v("CSS")]),s._v(" 文件。因此，你的样式将不再内嵌到 "),t("code",[s._v("JS bundle")]),s._v(" 中，而是会放到一个单独的 "),t("code",[s._v("CSS")]),s._v(" 文件（即 "),t("code",[s._v("styles.css")]),s._v("）当中。 如果你的样式文件大小较大，这会做更快提前加载，因为 "),t("code",[s._v("CSS bundle")]),s._v(" 会跟 "),t("code",[s._v("JS bundle")]),s._v(" 并行加载。")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("Webpack 4.0")]),s._v("以后将使用"),t("code",[s._v("mini-css-extract-plugin")]),s._v("代替")])])])}),[],!1,null,null,null);t.default=e.exports}}]);