# HTTP
> `HTTP`是一个在计算机世界里专门在两点之间传输文字、图片、音频、视频等超文本数据的约定和规范。

> 超文本传输协议，是互联网上应用最为广泛的一种网络协议，是一个客户端和服务器端请求和应答的标准`（TCP）`，用于从`WWW`服务器传输超文本到本地浏览器的传输协议，它可以使浏览器更加高效，使网络传输减少。

## 报文
`HTTP`报文分为两种：`HTTP`请求报文（请求行-`HTTP`头（通用信息头，请求头，实体头）-请求报文主体（只有`POST`才有报文主体）。响应报文则相对应的为状态行，响应报文主体。
> 通用信息头指的是请求和响应报文都支持的头域，分别为`Cache-Control`、`Connection`、`Date`、`Pragma`、`Transfer-Encoding`、`Upgrade`、`Via`；实体头则是实体信息的实体头域，分别为`Allow`、`Content-Base`、`Content-Encoding`、`Content-Language`、`Content-Length`、`Content-Location`、`Content-MD5`、`Content-Range`、`Content-Type`、`Etag`、`Expires`、`Last-Modified`、`extension-header`。

**常用头部字段解释：**
![img](/dovis-blog/other/18.png)

## HTTP历史
- `HTTP/0.9`
> 只有一个请求行，没有`HTTP`请求头和请求体。同样，服务器也没有响应头信息，只是返回了数据。因为都是`HTML`格式的文件，决定了返回的文件内容通过`ASCII`字符流进行传输。

- `HTTP/1.0`
> 引入请求头/响应头，引入状态码，为了减轻服务器压力提供了`Cache`机制。服务器需要统计客户端的基础信息(`Windows` 和 `macOS`)，加入了用户代理字段。

- `HTTP/1.1`
::: tip
1. 改进持久连接（长连接）
一个`TCP`连接上可以传输多个`HTTP`请求，只要浏览器或者服务器没有断开连接，该`TCP`会一直保持。持久连接是默认开启的，如果想要关闭，在请求头中加上`Connection:close`即可关闭。目前浏览器中对于同一个域名，默认允许同时建立`6`个`TCP`持久连接。

2. 增加对虚拟主机的支持
> `HTTP/1.0`中每个域名都只绑定唯一的`IP`地址，因此一个服务器只能支持一个域名。但是随着虚拟主机技术的发展，一台物理主机上绑定多个虚拟主机的需求大大提升，每个虚拟主机都有自己单独的域名，这些单独的域名都公用同一个`IP`地址。因此，请求头中也增加了`Host`字段，表示当前的域名地址，服务器可根据不同的`Host`值做不同的处理。

3. 增加对动态生产内容的支持
> `HTTP/1.0`需要在响应头中设置完整的数据大小`Content-Length：900`，这样，浏览器就可以根据设置的数据大小来接收数据。由于服务器端技术发展，页面都是动态生成的，传输数据之前并不知道最终数据大小，导致浏览器不知道何时会接受完所有的文件数据。`HTTP/1.1`通过引入`Chunk transfer`机制来解决问题，服务器将数据分割成若干个任意大小的数据块，每个数据块发送时会附上上一个数据块的长度，最后使用一个长度为`0`的块作为发送数据完成的标志。

4. 客户端`Cookie`，安全机制
5. 解决`http 1.0`的队头阻塞问题：请求之间是串行的。如果发送了`A`请求，那么`A`请求的响应返回之前，你的`B`请求不管多么着急发出去，都要取决了`A`请求是否结束了。`http1.1`则利用了管线化来解决这个问题。**管线化是指：允许多个`HTTP`请求批量地提交给服务器。不过这样做仍然没有从根本上解决队头阻塞的问题--虽然发送动作可以并行，不过服务器依然需要根据请求顺序来回复浏览器的请求，也就是说响应仍然是串行的。`A`如果一年没有被响应，`B`也休想被响应。**
:::

- `HTTP/2.0`
> 使用多路复用机制解决`TCP`慢启动；开启多条`TCP`连接会竞争固定带宽；队头阻塞的问题。（**一个域名只使用一个 `TCP` 长连接和消除队头阻塞问题。通过引入二进制分帧层，实现了 `HTTP` 的多路复用技术。**）

> 服务器可以提前将数据推送到浏览器，浏览器有权选择是否接受。浏览器发送`RST_STREAM`帧可以选择拒收。

> 头部的压缩大大的提升了传输效率。`HTTP/2`开发了“`HPACK`”算法，在客户端和服务器建立“字典”，用索引号表示重复的字符串，还采用哈夫曼编码来压缩整数和字符串。**客户端和服务器分别维护一份相同的静态字典，这个字典用来存储常见的头部名称，以及常见的头部名称和值的组合。同时还会维护一份相同的动态字典，这个字典可以随时更新。如此一来，第一次相互通信之后后面的请求只需要发送与前面请求之间头部不同的地方，其他头部信息都可以从字典里获取。相对于`HTTP1.x`中每次都要携带整个头部跑来跑去，大大节省了网络开销。**

> 可以设置让某些重要的数据优先被服务器处理并返回。

- `HTTP/3.0`

## `HTTP`状态码
- `1xx`：请求已经收到，但是处理过程还没结束，需要客户端再抛出一个请求才能完成整个过程（即需要进一步处理才能完成），`HTTP1.0`不支持
    + `100 Continue`：上传大文件前使用
    + `101 Switch Protocols`：协议升级使用
    + `102 Processing`：服务器已经收到并正在处理请求，但无响应可用

- `2xx`：成功处理请求
    + `200 OK`：成功返回响应
    + `201 Created`：有新资源在服务器端被成功创建
    + `202 Accepted`：服务器接受并开始处理请求，但请求未处理完成
    + `206 Partial Content`：使用`range`协议时返回部分响应内容时的响应码

> 重定向是服务器发起的跳转，要求客户端使用新的 `URI` 重新发送请求。在响应头字段 `Location` 中指示了要跳转的 `URI`。使用 `Refresh` 字段，还可以实现延时重定向。
- `3xx`：重定向
    + `301` / `302` 是常用的重定向状态码。分别代表永久性重定向和临时性重定向。    
    + `303`：类似于 `302`，重定向后的请求方法改为 `GET` 方法
    + `307`：类似于 `302`，含义比 `302` 更明确，重定向后请求的方法和实体不允许变动
    + `308`：类似于 `301`，代表永久重定向，重定向后请求的方法和实体不允许变动
    + `300`：是一个特殊的重定向状态码，会返回一个有多个链接选项的页面，由用户自行选择
    + `304`：是一个特殊的重定向状态码，服务端验证过期缓存有效后，要求客户端使用该缓存

- `4xx`：客户端出现错误
    + `400 Bad Request`：服务器认为客户端出现了错误，但不明确，一般是 `HTTP` 请求格式错误
    > 产生原因；前端提交数据的字段名称和字段类型与后台的实体没有保持一致；前端提交到后台的数据应该是`json`字符串类型，但是前端没有将对象`JSON.stringfy`转换为字符串
    + `401 Unauthorized`：用户认证信息确实或者不正确。发送的请求需要通过`HTTP`认证。
    + `403 Forbidden`：服务器理解请求的含义，但没有权限执行
    + `407 Proxy Authentication Required`：对需要经由代理的请求，认证信息未通过代理服务器的验证
    + `404 Not Found`：服务器没有找到对应的资源
    + `408 Request Timeout`：服务器接收请求超时
    + `405 Method Not Allowed`：请求方法不被服务端允许。

- `5xx`：服务器端出现错误
    + `500 Internal Server Error`：服务器内部错误，且不属于以下错误类型
    + `502 Bad Gateway`：代理服务器无法获取到合法响应
    + `503 Service Unavailable`：服务器资源尚未准备好处理当前请求。**服务器当前很忙，暂时无法响应**
    + `505 HTTP Version Not Supported`：请求使用的 `HTTP` 协议版本不支持

## HTTP几种方法
- `GET`：发送一个请求来获取服务器上的某一些资源
- `POST`：向URL指定的资源提交数据或附加新的数据
[GET和POST的区别](/basis/JavaScript/ajax原生.html/#http头部信息)
- `PUT`：跟`POST`方法一样，可以向服务器提交数据，但是它们之间也所有不同，`PUT`指定了资源在服务器的位置，而`POST`没有哦。
- `HEAD`：指请求页面的首部。
- `DELETE`：删除服务器上的某资源
- `OPTIONS`：它用于获取当前`URL`所支持的方法，如果请求成功，在`Allow`的头包含类似`GET,POST`等的信息。
[复杂请求的理解](/advanced/Browser/浏览器跨域.html#cors)
- `TRACE`：用于激发一个远程的，应用层的请求消息回路。
- `CONNECT`：把请求连接转换到`TCP/TP`通道。

## https协议的工作原理
- 客户使用`https url`访问服务器，则要求`web` 服务器建立`ssl`链接。
- `web`服务器接收到客户端的请求之后，会将网站的证书（证书中包含了公钥），返回或者说传输给客户端。
- 客户端和`web`服务器端开始协商`SSL`链接的安全等级，也就是加密等级。
- 客户端浏览器通过双方协商一致的安全等级，建立会话密钥，然后通过网站的公钥来加密会话密钥，并传送给网站。
- `web`服务器通过自己的私钥解密出会话密钥。
- `web`服务器通过会话密钥加密与客户端之间的通信。

## https优缺点
+ 优点：
    - 使用`HTTPS`协议可认证用户和服务器，确保数据发送到正确的客户机和服务器；
    - `HTTPS`协议是由`SSL+HTTP`协议构建的可进行加密传输、身份认证的网络协议，要比`http`协议安全，可防止数据在传输过程中不被窃取、改变，确保数据的完整性。
    - `HTTPS`是现行架构下最安全的解决方案，虽然不是绝对安全，但它大幅增加了中间人攻击的成本。
    - 谷歌曾在2014年8月份调整搜索引擎算法，并称“比起同等`HTTP`网站，采用`HTTPS`加密的网站在搜索结果中的排名将会更高”。

+ 缺点：
    - `https`握手阶段比较费时，会使页面加载时间延长`50%`，增加`10%~20%`的耗电。
    - `https`缓存不如`http`高效，会增加数据开销。
    - `SSL`证书也需要钱，功能越强大的证书费用越高。
    - `SSL`证书需要绑定`IP`，不能再同一个`ip`上绑定多个域名，`ipv4`资源支持不了这种消耗。


## http和https的区别
> `https`：是以安全为目标的`HTTP`通道，简单讲是`HTTP`的安全版，即`HTTP`下加入`SSL`层，`HTTPS`的安全基础是`SSL`，因此加密的详细内容就需要`SSL`。`https`协议的主要作用是：建立一个信息安全通道，来确保数据的传输，确保网站的真实性。

`http`传输的数据都是未加密的，也就是明文的，网景公司设置了`SSL`协议来对`http`协议传输的数据进行加密处理，简单来说`https`协议是由`http`和`ssl`协议构建的可进行加密传输和身份认证的网络协议，比`http`协议的安全性更高。
+ 主要的区别如下：
    - `Https`协议需要`ca`证书，费用较高。
    - `http`是超文本传输协议，信息是明文传输，`https`则是具有安全性的`ssl`加密传输协议。
    - 使用不同的链接方式，端口也不同，一般而言，`http`协议的端口为`80`，`https`的端口为`443`
    - `http`的连接很简单，是无状态的；`HTTPS`协议是由`SSL+HTTP`协议构建的可进行加密传输、身份认证的网络协议，比`http`协议安全。

## 对称加密
> 客户端和服务端约定一个共同的公钥，加密和解密都依赖这个公钥。这种情况一旦公钥被中间人劫持，双方传输的密文信息依然会被攻击。

## 非对称加密
> 公钥+私钥的方式加密。公钥和私钥是多对一的关系，公钥加密的内容只有私钥才可以解开，私钥加密的内容所有公钥都可以解开。中间人依然可以通过伪造公钥来攻击加密内容。这个时候就需要通过第三方认证`CA`。提供包含域名/公司信息/序列号/签名信息主要信息的证书。
