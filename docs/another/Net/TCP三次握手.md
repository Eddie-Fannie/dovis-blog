# `TCP`三次握手四次挥手
**计算机网络体系结构**

![img](/dovis-blog/other/10.png)

## `TCP/IP`（传输控制协议/网际协议）
1. 应用层
2. 传输层
> 传输层(transport layer)的主要任务就是负责向两台主机进程之间的通信提供通用的数据传输服务。

|  |  UDP  |  TCP |
|--|-------|------|
|是否连接 | 无连接 | 面向连接 |
|是否可靠|不可靠传输，不使用流量控制和拥塞控制|可靠传输，使用流量控制和拥塞控制|
|连接对象个数|支持一对一，一对多等多种方式通信|只能一对一|
|传输方式|面向报文|面向字节流|
|首部开销|小，仅8子节|首部最小20，最大60子节|
|场景|适用实时应用|适用可靠传输的应用，文件传输|

## TCP的三次握手和四次挥手
> 一个`TCP`连接由一个`4`元组构成，分别是两个`IP`地址和两个端口号。一个`TCP`连接通常分为三个阶段：**连接**、**数据传输**、**退出（关闭）**。**通过三次握手建立一个链接，通过四次挥手来关闭一个连接。** **当一个连接被建立或被终止时，交换的报文段只包含`TCP`头部，而没有数据。**

`TCP`报文头部结构
![img](/dovis-blog/other/11.png)

+ 重点字段
    - `seq`序号：占32位，用来标识TCP源向目的端发送的字节流，发送方发送数据时对此进行标记
    - 确认序号：`ack`序号，占32位，只有`ACK`标志位为`1`时，确认序号字段才有效，`ack=seq+1`。
    - 标志位
        + `ACK`：确认序号有效
        + `FIN`：释放一个连接
        + `PSH`：接收方应该尽快将这个报文交给应用层
        + `RST`：重置连接
        + `SYN`：发起一个新连接
        + `URG`：紧急指针有效

### 三次握手
> 确认通信双方收发数据的能力